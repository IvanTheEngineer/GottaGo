{% extends "users/base.html" %}
{% block navbar_and_footer %}
{% load custom_filters %}
{% load static %}
{% block content %}
<div style="padding-top: 20px;"></div>
<div class="mb-3 card mx-auto" style="width: 80%; text-align: center">
    <div class="card-body">
        <div style = "display: flex; align-items: start; justify-content: left; padding-bottom: 20px;">
            <div style="display: flex; gap: 10px; align-items: start; justify-content: center">
                <a style="text-align: left;" class="btn btn-primary" href="{% url 'detail' travelplan.primary_group_code %}"> Back</a> 
            </div>
            <div style="display: flex; gap: 10px; align-items: start; justify-content: flex-end; width: 100%;">
                <a href="{% url 'edit_destination' primary_group_code=destination.travel_plan.primary_group_code id=destination.id %}" class="btn btn-primary">Edit</a>
            </div>
        </div>
                <div class="travel-plan-banner mb-3" style="position: relative">
            {% if travelplan.jpg_upload_file %}
                <img src="{{ travelplan.jpg_upload_file.url }}" class="img-fluid w-100" alt="{{ travelplan.plan_name }} Banner image" style="height: 200px; object-fit: cover;"/>
            {% else %}
                <img src="{% static 'images/no_image.jpg' %}" class="img-fluid" alt="no image" style="object-fit: cover"/>
            {% endif %}

            <div class="gradient-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: black; opacity: 50%"></div>
            <div class="banner-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 10px; opacity: 100%; color: white; -webkit-text-stroke: 0.0px darkorchid">
                <h1 class="mb-2">{{ travelplan.plan_name }} </h1>
                <p style="font-size: 20px"><strong>Group Code:</strong> {{ travelplan.primary_group_code }} </p>
                <p style="font-size: 20px"><strong>Group Size:</strong> {{ travelplan.group_size }} </p>
                {% if travelplan.start_date and travelplan.end_date%}
                    <p style="font-size: 20px"><strong>Dates: </strong> {{ travelplan.start_date }} <strong> - </strong> {{ travelplan.end_date }}</p>
                {% else %}
                    <p style="font-size: 20px"><strong>Dates: </strong> None</p>
                {% endif %}
            </div>
        </div>

    <!--<h3 class="mb-2">Destination page test | {{ travelplan.plan_name }} </h3>
        <p style="font-size: 20px"><strong>Group Code:</strong> {{ travelplan.primary_group_code }} </p>
        <p style="font-size: 20px"><strong>Group Size:</strong> {{ travelplan.group_size }} </p>
        <p style="font-size: 20px"><strong>Description:</strong> {{ travelplan.trip_description }} </p>

        <div class="mt-3">
            <p style="font-size: 20px"><strong>Images:</strong></p>
            {% if travelplan.jpg_upload_file %}
            <img src="{{ travelplan.jpg_upload_file.url }}" width="400" height="400" class="rounded"
                alt="{{ travelplan.plan_name }} image" />
            {% else %}
            <p>No images uploaded.</p>
            {% endif %}
        </div> -->
        {% if destination %}

                {% if destination.travel_plan.id == travelplan.id %}

                    <h1 class="mb-2">{{ destination.destination_name }}</h1>
                    <p style="font-size: 20px"><strong>Description:</strong> {{ destination.destination_description }} </p>




                    <div class="mt-3">

                        <div style="display: flex; gap: 20px; align-items: start; justify-content: center">
                            <div>
                                
                                {% if destination.jpg_upload_file %}
                                <div style = "display: flex; gap: 10px; align-items: center; justify-content: center;">
                                <p style="margin: 0; font-size: 20px"><strong>Image:</strong></p>
                                <a href="{{ destination.jpg_upload_file.url }}" target="_blank" class="btn btn-outline-primary">
                                    View
                                </a>
                                </div>
                                <img style="margin-bottom: 20px;" src="{{ destination.jpg_upload_file.url }}" width="150" height="150" class="rounded mt-3"
                                alt="{{ destination.destination_name }} image" />
                                {% else %}
                                    <p style="margin: 0; font-size: 20px"><strong>Image:</strong></p>
                                    <p>No image uploaded.</p>
                                {% endif %}
                                {% if destination.jpg_metadata %}
                                {% with metadata=destination.jpg_metadata %}
                                <div style="text-align: left; margin-left: 20px; margin-right: 20px;" >
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Title:</strong> {{ metadata.file_title }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Description:</strong> {{ metadata.description }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Keywords:</strong> {{ metadata.keywords }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Uploaded:</strong> {{ metadata.upload_timestamp|date:"F j, Y" }}
                                    </p>
                                </div>
                                {% endwith %}
                                {% endif %}
                            </div>
                            <div>
                                {% if destination.txt_upload_file %}
                                <div style = "display: flex; gap: 10px; align-items: center; justify-content: center;">
                                <p style="margin: 0; font-size: 20px"><strong>Text File:</strong></p>
                                <a href="{% url 'download_file' %}?txturl={{ destination.txt_upload_file.url}}&filename={{ destination.txt_upload_file }}" class="btn btn-primary"> Download</a>
                                <a href="{{ destination.txt_upload_file.url }}" target="_blank" class="btn btn-outline-primary">
                                    View
                                </a>
                                </div>
                                <div class="mt-3" style="text-align: center">
                                    <iframe src="{{ destination.txt_upload_file.url }}"
                                        style="border: #dddddd; box-shadow: 0 0 10px darkmagenta; margin-bottom: 20px;"></iframe>
                                </div>
                                {% else %}
                                <p style="margin: 0; font-size: 20px"><strong>Text File:</strong></p>
                                <p>No text file uploaded.</p>
                                {% endif %}
                                {% if destination.txt_metadata %}
                                {% with metadata=destination.txt_metadata %}
                                <div style="text-align: left; margin-left: 10px; margin-right: 10px;">
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Title:</strong> {{ metadata.file_title }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Description:</strong> {{ metadata.description }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Keywords:</strong> {{ metadata.keywords }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Uploaded:</strong> {{ metadata.upload_timestamp|date:"F j, Y" }}
                                    </p>
                                </div>
                                {% endwith %}
                                {% endif %}
                            </div>

                        </div>
                            <div>
                                
                                {% if destination.pdf_upload_file %}
                                <div class="mt-3" style = "display: flex; gap: 10px; align-items: center; justify-content: center;">
                                    <p style="margin: 0;font-size: 20px"><strong>PDF Files:</strong></p>
                                    <a href="{{ destination.pdf_upload_file.url }}" target="_blank" class="btn btn-outline-primary">
                                        View
                                    </a>
                                    </a>
                                </div>
                                <div class="mt-3" style="width: 100%;">
                                    <iframe class="fa-file-pdf-o" src="{{ destination.pdf_upload_file.url }}" width="80%" height="400px"
                                        loading="lazy" style="border: #dddddd; margin-bottom: 20px;"></iframe>

                                </div>
                                {% else %}
                                <p class="mt-3" style="margin: 0; font-size: 20px"><strong>PDF File:</strong></p>
                                <p>No PDF file uploaded.</p>
                                {% endif %}
                                {% if destination.pdf_metadata %}
                                {% with metadata=destination.pdf_metadata %}
                                <div style="text-align: left; margin-left: 10%; margin-right: 10%;">
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Title:</strong> {{ metadata.file_title }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Description:</strong> {{ metadata.description }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Keywords:</strong> {{ metadata.keywords }}
                                    </p>
                                    <p style="margin: 0;" class="text-paragraph">
                                        <strong>Uploaded:</strong> {{ metadata.upload_timestamp|date:"F j, Y" }}
                                    </p>
                                </div>
                                {% endwith %}
                                {% endif %}
                            </div>
                        </div>

                        <div class="my-3">
                            <h4><strong>Expenses Summary:</strong></h4>
                            {% if total_expenses %}
                                <p class="fs-5">Total Expenses: ${{ total_expenses|floatformat:2 }}</p>
                                <a href="{% url 'destination_budget' primary_group_code=destination.travel_plan.primary_group_code id=destination.id %}" 
                                   class="btn btn-primary">
                                    View Budget Details
                                </a>
                            {% else %}
                                <p>No expenses listed</p>
                                <a href="{% url 'destination_budget' primary_group_code=destination.travel_plan.primary_group_code id=destination.id %}" 
                                   class="btn btn-primary">
                                    Add Expenses
                                </a>
                            {% endif %}
                        </div>

                        <div>
                            <h4> <strong> Comments: </strong> </h4>
                                {% if destination.comments %}

                                    {% for comment in page_obj %}
                                        <div style="text-align: center; margin-left: 5%; margin-right: 5%">
                                            <strong>{{ comment.user.email }}</strong>: {{ comment.commentText }} | {{ comment.upload_timestamp|date:"F j, Y"  }}
                                        </div>
                                    {% endfor %}
                                    <div class="pagination" style="justify-content: center">
                                        <span class="step-links">
                                            {% if page_obj.has_previous %}
                                                <a href="?page=1">&laquo; first</a>
                                                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                                            {% endif %}

                                            <span class="current">
                                                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                                            </span>

                                            {% if page_obj.has_next %}
                                                <a href="?page={{ page_obj.next_page_number }}">next</a>
                                                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                                            {% endif %}
                                        </span>
                                    </div>
                                {% else %}
                                    <p>No comments posted</p>
                                {% endif %}
                                {% if user.is_authenticated %}
                                    <form method="post" class="mt-4">
                                        {% csrf_token %}
                                        {{ form.as_p }}
                                        <button type = "submit" class="btn btn-primary">
                                            Submit Comment
                                        </button>
                                    </form>
                                {% else %}
                                    <p> <a href="{% url 'login' %}"> Login </a> to comment</p>
                                {% endif %}
                        </div>
                {% endif %}


        {% endif %}


    </div>



</div>

{% endblock content %}
{% endblock %}